<!DOCTYPE html>
<html lang="en">
<head>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>StreamFlix - Home</title>
  <!-- Font Awesome Icons -->
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
  referrerpolicy="no-referrer"
  />

  <!-- CSS File -->
  <link rel="stylesheet" href="/css/home.css" />
</head>
<body>
 <!-- Popup Modal -->
<div id="questionnaire-modal" class="modal">
  <div class="modal-content">
    <h2>Quick Questionnaire</h2>
    <form id="questionnaire-form" method="post" action="/save-genres">
      <input type="hidden" name="userId" id="userId" />
      <label for="favorite-genres" class="form-label">Select your favorite genres:</label>
      <div id="genre-checkboxes" class="genre-grid">
        <div class="genre-column">
          <label><input type="checkbox" name="genres" value="Action" /> Action</label>
          <label><input type="checkbox" name="genres" value="Adventure" /> Adventure</label>
          <label><input type="checkbox" name="genres" value="Animation" /> Animation</label>
          <label><input type="checkbox" name="genres" value="Biography" /> Biography</label>
          <label><input type="checkbox" name="genres" value="Comedy" /> Comedy</label>
        </div>
        <div class="genre-column">
          <label><input type="checkbox" name="genres" value="Crime" /> Crime</label>
          <label><input type="checkbox" name="genres" value="Documentary" /> Documentary</label>
          <label><input type="checkbox" name="genres" value="Drama" /> Drama</label>
          <label><input type="checkbox" name="genres" value="Family" /> Family</label>
          <label><input type="checkbox" name="genres" value="Fantasy" /> Fantasy</label>
        </div>
        <div class="genre-column">
          <label><input type="checkbox" name="genres" value="Film-Noir" /> Film-Noir</label>
          <label><input type="checkbox" name="genres" value="Game-Show" /> Game-Show</label>
          <label><input type="checkbox" name="genres" value="History" /> History</label>
          <label><input type="checkbox" name="genres" value="Horror" /> Horror</label>
          <label><input type="checkbox" name="genres" value="Music" /> Music</label>
        </div>
        <div class="genre-column">
          <label><input type="checkbox" name="genres" value="Musical" /> Musical</label>
          <label><input type="checkbox" name="genres" value="Mystery" /> Mystery</label>
          <label><input type="checkbox" name="genres" value="News" /> News</label>
          <label><input type="checkbox" name="genres" value="Reality-TV" /> Reality-TV</label>
          <label><input type="checkbox" name="genres" value="Romance" /> Romance</label>
        </div>
        <div class="genre-column">
          <label><input type="checkbox" name="genres" value="Sci-Fi" /> Sci-Fi</label>
          <label><input type="checkbox" name="genres" value="Short" /> Short</label>
          <label><input type="checkbox" name="genres" value="Sport" /> Sport</label>
          <label><input type="checkbox" name="genres" value="Talk-Show" /> Talk-Show</label>
          <label><input type="checkbox" name="genres" value="Thriller" /> Thriller</label>
        </div>
        <div class="genre-column">
          <label><input type="checkbox" name="genres" value="War" /> War</label>
          <label><input type="checkbox" name="genres" value="Western" /> Western</label>
        </div>
      </div>
      <button type="submit" class="submit-btn">Submit</button>
    </form>
  </div>
</div>

  <!-- Netflix-style Top Nav -->
  <header class="top-nav" id="dynamic-menu">
    <div class="nav-left">
      <span class="logo-text">StreamFlix</span>
      <ul class="nav-menu">
        <li><a href="#"><i class="fa-solid fa-house"></i> Home</a></li>
        <li><a href="/shop"><i class="fa-solid fa-cart-shopping"></i> Shop</a></li>
      </ul>
    </div>
    <div class="nav-right">
      <span class="nav-icon" id="points">
        Points: <span th:text="${session.loggedUser != null ? session.loggedUser.points : 0}"></span>
      </span>
      <a href="/login" class="nav-icon" id="logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
    </div>
  </header>
  


  <!-- Main Banner -->
  <section class="banner" id="dynamic-banner">
    <div class="video-background">
      <iframe
        src="https://www.youtube.com/embed/6ZfuNTqbHE8?autoplay=1&mute=1&loop=1&playlist=6ZfuNTqbHE8&controls=0&modestbranding=1&iv_load_policy=3&rel=0&disablekb=1&playsinline=1&showinfo=0&fs=0"
        frameborder="0"
        allow="autoplay; fullscreen"
        allowfullscreen
       
      ></iframe>
    </div>
    <div class="banner-content" id="banner-content">
      <h1>Avengers: Infinity War</h1>
      <p>The Avengers must stop Thanos, an intergalactic warlord, from acquiring all six Infinity Stones.</p>
      <a href="/movie" class="play-button">Play</a>
      <button>More Info</button>
    </div>
  </section>

  <!-- Genre Filter (optional) -->
  <section class="genre-filter">
    <h2>Choose a Genre</h2>
    <div class="genre-buttons">
      <button class="genre-button" data-genre="all">All</button>
      <button class="genre-button" data-genre="action">Action</button>
      <button class="genre-button" data-genre="comedy">Comedy</button>
      <button class="genre-button" data-genre="drama">Drama</button>
      <button class="genre-button" data-genre="horror">Horror</button>
      <button class="genre-button" data-genre="sci-fi">Sci-Fi</button>
      <button class="genre-button" data-genre="romance">Romance</button>
    </div>
  </section>

  <!-- Section: Trending Now -->
  <section class="movies-section">
    <h2>Trending Now</h2>
    <div class="movie-list-wrapper">
      <button class="scroll-button left" onclick="scrollLeft(this)">&#8249;</button>
      <ul class="movie-list">
        <li class="movie-item" data-random-image>
          <div class="movie-thumbnail">
            <img src="" alt="Movie 1" />
          </div>
          <div class="movie-details">
            <h3 class="movie-title">Movie Title 1</h3>
            <p class="movie-info">Rating: 8.5 | Year: 2023</p>
          </div>
        </li>
        <li class="movie-item" data-random-image>
          <div class="movie-thumbnail">
            <img src="" alt="Movie 2" />
          </div>
          <div class="movie-details">
            <h3 class="movie-title">Movie Title 2</h3>
            <p class="movie-info">Rating: 7.8 | Year: 2022</p>
          </div>
        </li>
        <li class="movie-item" data-random-image>
          <div class="movie-thumbnail">
            <img src="" alt="Movie 3" />
          </div>
          <div class="movie-details">
            <h3 class="movie-title">Movie Title 3</h3>
            <p class="movie-info">Rating: 9.0 | Year: 2021</p>
          </div>
        </li>
      </ul>
      <button class="scroll-button right" onclick="scrollRight(this)">&#8250;</button>
    </div>
  </section>

  <!-- Display error message if present -->
  <div th:if="${error}" class="error-message">
    <p th:text="${error}"></p>
  </div>

  <!-- Section: Top Movies by Genre -->
  <section class="movies-by-genre" th:if="${topGenresMovies != null}" th:each="entry : ${topGenresMovies}">
    <h2 th:text="'Top Movies in ' + ${entry.key}">Top Movies in Genre</h2>
    <div class="movie-list-wrapper">
      <button class="scroll-button left" onclick="scrollLeft(this)">&#8249;</button>
      <ul class="movie-list">
        <li class="movie-item" th:each="movie : ${entry.value}">
          <div class="movie-thumbnail">
            <img th:src="@{/images/FaíscMcQueen.jpg}" th:alt="${movie['title']}" />
          </div>
          <div class="movie-details">
            <h3 class="movie-title" th:text="${movie['title']}">Movie Title</h3>
            <p class="movie-info" th:text="'Rating: ' + ${movie['averageRating']} + ' | Year: ' + (${movie['releaseYear'] != null ? movie['releaseYear'] : 'Unknown'})">
              Rating: X.X | Year: YYYY
            </p>
          </div>
        </li>
      </ul>
      <button class="scroll-button right" onclick="scrollRight(this)">&#8250;</button>
    </div>
  </section>

  <!-- Script to dynamically extract the dominant color of the image and apply it as the border color on hover -->
  <script>
    document.querySelectorAll('.movie-card img').forEach((img) => {
      img.addEventListener('mouseenter', () => {
        const colorThief = new ColorThief();
        if (img.complete) {
          const dominantColor = colorThief.getColor(img);
          img.style.borderColor = `rgb(${dominantColor.join(',')})`; // Apply dominant color to border
        }
      });
      img.addEventListener('mouseleave', () => {
        img.style.borderColor = 'transparent'; // Reset border color
      });
    });

// Mostrar o modal automaticamente se o parâmetro "showQuestionnaire" estiver na URL
window.onload = function () {
  const urlParams = new URLSearchParams(window.location.search);
  const userId = urlParams.get('userId');
  if (userId) {
    document.getElementById('userId').value = userId;
    const modal = document.getElementById('questionnaire-modal');
    modal.style.display = 'block';
  }
};

// Remover a funcionalidade de fechar o modal ao clicar fora dele
window.onclick = function (event) {
  const modal = document.getElementById('questionnaire-modal');
  if (event.target === modal) {
    alert('You must complete the questionnaire to proceed.');
  }
};

// Handle form submission
document.getElementById('questionnaire-form').onsubmit = (e) => {
  e.preventDefault();
  const selectedGenres = document.querySelectorAll('input[name="genres"]:checked');
  if (selectedGenres.length < 3) {
    alert('Please select at least 3 genres.');
    return;
  }
  // Submeter o formulário
  e.target.submit();
};

  function scrollLeft(button) {
    const wrapper = button.parentElement.querySelector('.movie-list');
    wrapper.scrollBy({ left: -wrapper.offsetWidth, behavior: 'smooth' }); // Scroll left by the width of the container
  }

  function scrollRight(button) {
    const wrapper = button.parentElement.querySelector('.movie-list');
    wrapper.scrollBy({ left: wrapper.offsetWidth, behavior: 'smooth' }); // Scroll right by the width of the container
  }

  // Array of random image URLs
  const randomImages = [
    '/imagesMovies/8.0_84654.jpg',
    '/imagesMovies/8.0_84740.jpg',
    '/imagesMovies/8.0_88247.jpg',
    '/imagesMovies/8.0_88258.jpg',
    '/imagesMovies/8.0_88846.jpg',
    '/imagesMovies/8.0_91167.jpg',
    '/imagesMovies/8.0_91480.jpg',
    '/imagesMovies/8.0_95953.jpg',
    '/imagesMovies/8.0_96028.jpg',
    '/imagesMovies/8.0_97123.jpg',
    '/imagesMovies/8.0_97165.jpg',
    '/imagesMovies/8.0_99028.jpg',
    '/imagesMovies/8.0_99348.jpg',
    '/imagesMovies/8.1_100332.jpg',
    '/imagesMovies/8.1_10323.jpg',
    '/imagesMovies/8.1_106332.jpg',
    '/imagesMovies/8.1_107290.jpg',
    '/imagesMovies/8.1_107472.jpg',
    '/imagesMovies/8.1_109424.jpg',
    '/imagesMovies/8.1_110882.jpg',
    '/imagesMovies/8.1_111495.jpg',
    '/imagesMovies/8.1_112373.jpg',
    '/imagesMovies/8.1_112471.jpg',
    '/imagesMovies/8.1_113247.jpg',
    '/imagesMovies/8.1_114787.jpg',
    '/imagesMovies/8.1_116282.jpg',
    '/imagesMovies/8.1_116506.jpg',
    '/imagesMovies/8.1_117907.jpg',
    '/imagesMovies/8.1_118694.jpg',
    '/imagesMovies/8.1_118843.jpg',
    '/imagesMovies/8.1_120382.jpg',
    '/imagesMovies/8.1_120731.jpg',
    '/imagesMovies/8.1_12364.jpg',
    '/imagesMovies/8.1_145046.jpg',
    '/imagesMovies/8.1_15064.jpg',
    '/imagesMovies/8.1_154420.jpg',
    '/imagesMovies/8.1_167404.jpg',
    '/imagesMovies/8.1_16847.jpg',
    '/imagesMovies/8.1_168515.jpg',
    '/imagesMovies/8.1_198781.jpg',
    '/imagesMovies/8.1_20629.jpg',
    '/imagesMovies/8.1_221344.jpg',
    '/imagesMovies/8.1_23042.jpg',
    '/imagesMovies/8.1_24069.jpg',
    '/imagesMovies/8.1_243664.jpg',
    '/imagesMovies/8.1_244316.jpg',
    '/imagesMovies/8.1_245712.jpg',
    '/imagesMovies/8.1_25878.jpg',
    '/imagesMovies/8.1_264464.jpg',
    '/imagesMovies/8.1_266543.jpg',
    '/imagesMovies/8.1_266697.jpg',
    '/imagesMovies/8.1_27532.jpg',
    '/imagesMovies/8.1_276919.jpg',
    '/imagesMovies/8.1_28010.jpg',
    '/imagesMovies/8.1_28950.jpg',
    '/imagesMovies/8.1_307385.jpg',
    '/imagesMovies/8.1_31885.jpg',
    '/imagesMovies/8.1_32138.jpg',
    '/imagesMovies/8.1_32551.jpg',
    '/imagesMovies/8.1_33045.jpg',
    '/imagesMovies/8.1_338564.jpg',
    '/imagesMovies/8.1_34240.jpg',
    '/imagesMovies/8.1_35140.jpg',
    '/imagesMovies/8.1_36244.jpg',
    '/imagesMovies/8.1_36868.jpg',
    '/imagesMovies/8.1_37008.jpg',
    '/imagesMovies/8.1_374546.jpg',
    '/imagesMovies/8.1_37558.jpg',
    '/imagesMovies/8.1_379557.jpg',
    '/imagesMovies/8.1_38190.jpg',
    '/imagesMovies/8.1_38733.jpg',
    '/imagesMovies/8.1_38890.jpg',
    '/imagesMovies/8.1_39689.jpg',
    '/imagesMovies/8.1_41546.jpg',
    '/imagesMovies/8.1_41719.jpg',
    '/imagesMovies/8.1_44008.jpg',
    '/imagesMovies/8.1_44837.jpg',
    '/imagesMovies/8.1_46250.jpg',
    '/imagesMovies/8.1_46911.jpg',
    '/imagesMovies/8.1_47528.jpg',
    '/imagesMovies/8.1_49012.jpg',
    '/imagesMovies/8.1_51459.jpg',
    '/imagesMovies/8.1_51808.jpg',
    '/imagesMovies/8.1_52561.jpg',
    '/imagesMovies/8.1_52600.jpg',
    '/imagesMovies/8.1_52618.jpg',
    '/imagesMovies/8.1_53198.jpg',
    '/imagesMovies/8.1_53779.jpg',
    '/imagesMovies/8.1_54460.jpg',
    '/imagesMovies/8.1_55499.jpg',
    '/imagesMovies/8.1_56217.jpg',
    '/imagesMovies/8.1_56241.jpg',
    '/imagesMovies/8.1_56663.jpg',
    '/imagesMovies/8.1_56687.jpg',
    '/imagesMovies/8.1_56801.jpg',
    '/imagesMovies/8.1_57058.jpg',
    '/imagesMovies/8.1_57091.jpg',
    '/imagesMovies/8.1_57358.jpg',
    '/imagesMovies/8.1_58946.jpg',
    '/imagesMovies/8.1_59527.jpg'
];

  // Assign random images to all movie items
  document.querySelectorAll('[data-random-image]').forEach((movieItem) => {
    const randomIndex = Math.floor(Math.random() * randomImages.length);
    const imgElement = movieItem.querySelector('img');
    imgElement.src = randomImages[randomIndex];
  });

  // Assign random images to all movie items in "Top Movies by Genre"
  document.querySelectorAll('.movies-by-genre .movie-item').forEach((movieItem) => {
    const randomIndex = Math.floor(Math.random() * randomImages.length);
    const imgElement = movieItem.querySelector('img');
    imgElement.src = randomImages[randomIndex];
  });
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>
</body>
</html>
