<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>
    <link rel="stylesheet" type="text/css" href="/css/shop.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" referrerpolicy="no-referrer" />
</head>
<body>
    <header class="top-nav">
        <div class="nav-left">
            <span class="logo-text">StreamFlix</span>
            <a href="/home" class="button">Home</a>
        </div>
        <div class="nav-right">
            <span class="nav-icon">Points: <span th:text="${session.loggedUser != null ? session.loggedUser.points : 0}"></span></span>
            <a href="/battlepass" class="nav-icon"><i class="fa-solid fa-gift"></i> Battle Pass Rewards</a>
            <a href="/login" class="nav-icon"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
        </div>
    </header>

    <div class="banner">
        <h1>Win Exclusive Rewards!</h1>
        <p>Trade your points for rewards.</p>
    </div>
    <div class="countdown">
        <p>Next shop refresh in: <span id="countdown"></span></p>
    </div>
    <div class="container" id="rewards">
        <h2>Available Amazon Products</h2>
        <div class="grid">
            <div class="card" th:each="product : ${shop.products}">
                <img src="https://via.placeholder.com/300" alt="Product Image">
                <h3 th:text="${product.productName}">Product Name</h3>
                <p th:text="${product.category}">Category</p>
                <span class="points" th:text="'Cost ' + ${product.cost} + ' points'">Cost and Points</span>
                <a href="#" class="button">Redeem</a>
            </div>
        </div>
    </div>

    <div class="container" id="recommended-movies">
        <h2>Available Movies</h2>
        <div class="grid">
            <div class="card" th:each="movie : ${shop.movies}">
                <img src="https://via.placeholder.com/300" alt="Movie Image">
                <h3 th:text="${movie.title}">Movie Title</h3>
                <p th:text="${movie.genres}">Genres</p>
                <span class="points" th:text="'Rating: ' + ${movie.averageRating}">Average Rating</span>
                <p th:text="'Release Year: ' + ${movie.releaseYear}">Release Year</p>
                <span class="points">Cost 999 points</span>
                <a href="#" class="button">Redeem</a>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        const countdownElement = document.getElementById('countdown');
        const nextRefreshTime = new Date(/*[[${countdownDate}]]*/).getTime(); // Ensure countdownDate is passed as a valid ISO string

        function updateCountdown() {
            const now = new Date().getTime();
            const timeLeft = nextRefreshTime - now;

            if (timeLeft <= 0) {
                countdownElement.textContent = "Shop is refreshing...";
                return;
            }

            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            countdownElement.textContent = `${days} days, ${hours} hours, ${minutes} minutes, ${seconds} seconds`;
        }

        setInterval(updateCountdown, 1000);
        updateCountdown();
    </script>
</body>
</html>