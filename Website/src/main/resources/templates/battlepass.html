<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Pass</title>
    <link rel="stylesheet" href="/css/battlepass.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" referrerpolicy="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <header class="top-nav">
        <div class="nav-left">
            <span class="logo-text">StreamFlix</span>
        </div>
        <div class="nav-right">
            <ul class="nav-menu">
                <li><a href="/home"><i class="fa-solid fa-house"></i> Home</a></li>
                <li><a href="/shop"><i class="fa-solid fa-cart-shopping"></i> Shop</a></li>
                <li><a href="/login"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
            </ul>
            <span class="nav-icon" id="points">
                Points: <span th:text="${loggedUser != null ? loggedUser.points : 0}"></span>
            </span>
        </div>
    </header>
    <section class="banner">
        <div class="banner-content">
            <h1>Battle Pass Rewards</h1>
            <p>Unlock exclusive rewards as you progress through the tiers!</p>
        </div>
    </section>
    <div class="battle-pass-container">
        <div class="progress-bar-container">
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%;"></div>
                <span class="progress-value" id="progress-value">0 / 1000</span>
            </div>
            <div class="tier-number" id="tier-number">Tier 1</div>
            <p id="progress-summary">Unlocked Tiers: 0 / 10</p>
        </div>
        <div class="tier-progress-horizontal">
            <div class="tier" onclick="collectReward(1)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(2)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(3)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(4)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(5)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(6)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(7)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(8)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(9)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
            <div class="tier" onclick="collectReward(10)">
                <div class="reward">
                    <img src="/images/FaíscMcQueen.jpg" alt="Reward">
                </div>
            </div>
        </div>
    </div>
    <div class="missions-container">
        <h2>Daily Missions</h2>
        <ul>
            <li>
                <span>Login Daily</span>
                <button onclick="completeMission('loginDaily')">Complete</button>
            </li>
            <li>
                <span>Watch 3 Movies</span>
                <button onclick="completeMission('watch3Movies')">Complete</button>
            </li>
            <li>
                <span>Rate 5 Movies</span>
                <button onclick="completeMission('rate5Movies')">Complete</button>
            </li>
            <li>
                <span>Share a Movie</span>
                <button onclick="completeMission('shareMovie')">Complete</button>
            </li>
            <li>
                <span>Invite a Friend</span>
                <button onclick="completeMission('inviteFriend')">Complete</button>
            </li>
            <li>
                <span>Complete a Genre Quiz</span>
                <button onclick="completeMission('completeGenreQuiz')">Complete</button>
            </li>
            <li>
                <span>Redeem a Reward</span>
                <button onclick="completeMission('redeemReward')">Complete</button>
            </li>
            <li>
                <span>Reach Tier 5</span>
                <button onclick="completeMission('reachTier5')">Complete</button>
            </li>
            <li>
                <span>Spend 100 Points</span>
                <button onclick="completeMission('spend100Points')">Complete</button>
            </li>
            <li>
                <span>Unlock All Tiers</span>
                <button onclick="completeMission('unlockAllTiers')">Complete</button>
            </li>
        </ul>
    </div>
    <script>
        let currentTier = 1; // Start at Tier 1
        let currentPoints = 0; // Start with 0 points
        const maxPoints = 1000; // 10 tiers * 100 points per tier
        const pointsPerTier = 100; // Points required to complete each tier

        function collectReward(tier) {
            const requiredPoints = (tier - 1) * pointsPerTier; // Calculate required points for the tier
            if (currentPoints >= requiredPoints) {
                if (tier === currentTier) {
                    currentPoints += pointsPerTier;
                    if (currentPoints >= maxPoints) {
                        currentPoints = maxPoints;
                        currentTier = 11; // Set to 11 to indicate all tiers are unlocked
                        alert("Congratulations! You've reached the maximum tier!");
                        launchConfetti(); // Trigger confetti effect
                    } else {
                        currentTier++;
                    }
                    updateProgress();
                } else {
                    alert("You need to unlock the current tier first!");
                }
            } else {
                alert(`You need ${requiredPoints} points to unlock Tier ${tier}!`);
            }
        }

        function updateProgress() {
            const progressBarFill = document.getElementById("progress-bar-fill");
            const progressValue = document.getElementById("progress-value");
            const tierNumber = document.getElementById("tier-number");
            const progressSummary = document.getElementById("progress-summary");

            const progressPercentage = (currentPoints / maxPoints) * 100;
            progressBarFill.style.width = `${progressPercentage}%`;
            progressValue.textContent = `${currentPoints} / ${maxPoints}`;
            tierNumber.textContent = `Tier ${Math.min(currentTier, 10)}`; // Display Tier 10 as the maximum
            progressSummary.textContent = `Unlocked Tiers: ${Math.min(currentTier - 1, 10)} / 10`; // Update to 10/10 when Tier 10 is unlocked
        }

        function launchConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function completeMission(missionName) {
            fetch('/completeMission', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `missionName=${missionName}`
            }).then(response => {
                if (response.ok) {
                    alert('Mission completed!');
                    currentPoints += pointsPerTier; // Increment points for completing a mission
                    if (currentPoints >= maxPoints) {
                        currentPoints = maxPoints;
                        currentTier = 11; // Set to 11 to indicate all tiers are unlocked
                        alert("Congratulations! You've reached the maximum tier!");
                        launchConfetti(); // Trigger confetti effect
                    } else {
                        while (currentPoints >= currentTier * pointsPerTier && currentTier <= 10) {
                            currentTier++; // Increment tier if points threshold is reached
                        }
                    }
                    updateProgress(); // Update progress bar and unlocked tiers
                } else {
                    alert('Failed to complete mission.');
                }
            });
        }

        // Initialize progress bar and tier display on page load
        document.addEventListener("DOMContentLoaded", () => {
            updateProgress();
        });
    </script>
</body>
</html>
